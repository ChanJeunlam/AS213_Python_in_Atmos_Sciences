
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>大气数据处理及可视化 &#8212; AS213 Python in Atmospheric Sciences</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="地图数据处理及可视化" href="integrated_examples_1.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/sysu_logo.gif" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">AS213 Python in Atmospheric Sciences</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   AS213: Python in Atmosphric Sciences
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Pandas
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Pandas/Pandas_1.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Pandas
    </span>
   </code>
   - 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Pandas/Pandas_2.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Pandas
    </span>
   </code>
   - 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Pandas/Pandas_3.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Pandas
    </span>
   </code>
   - 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Pandas/Pandas_homework.html">
   Pandas homework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Pandas/%E6%80%9D%E8%80%83%E9%A2%98.html">
   思考题
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Pandas/%E6%80%9D%E8%80%83%E9%A2%98_%E7%AD%94%E6%A1%88.html">
   思考题答案
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Matplotlib
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../Matplotlib/Matplotlib_advanced.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Matplotlib
    </span>
   </code>
   进阶
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Matplotlib/Matplotlib_homework.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Matplotlib
    </span>
   </code>
   作业
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  xarray
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../xarray/xarray-1.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Xarray
    </span>
   </code>
   数据处理（１）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../xarray/xarray-2.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Xarray
    </span>
   </code>
   数据处理（2）
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Cartopy
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../cartopy/Cartopy_1.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Cartopy
    </span>
   </code>
   地图绘制（1）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cartopy/Cartopy_2.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Cartopy
    </span>
   </code>
   地图绘制（2）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cartopy/Cartopy_3.html">
   <code class="docutils literal notranslate">
    <span class="pre">
     Cartopy
    </span>
   </code>
   地图绘制（3）
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Exercises/Exercise_El_Nino.html">
   xarray/cartopy 作业
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Intergrated examples
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="integrated_examples_1.html">
   地图数据处理及可视化
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   大气数据处理及可视化
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Integrated_examples/integrated_examples_2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/smartlixx/AS213_Python_in_Atmos_Sciences"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/smartlixx/AS213_Python_in_Atmos_Sciences/issues/new?title=Issue%20on%20page%20%2FIntegrated_examples/integrated_examples_2.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/smartlixx/AS213_Python_in_Atmos_Sciences/master?urlpath=tree/Integrated_examples/integrated_examples_2.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   全球平均气温
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     中国区域的平均气温
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#wrf">
   WRF 数据处理和可视化
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ncl-python-geocat">
     NCL -&gt; Python: geoCAT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#metpy">
     MetPy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unidata-python-gallery">
     Unidata Python Gallery
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id4">
   时间序列分析和可视化
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     极端天气分析
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>大气数据处理及可视化<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>知识点：大气（包括海洋）数据读取、处理及可视化，包括模式结果处理</p></li>
<li><p>工具：xarray, wrf-python, pandas, cartopy, regionmask</p></li>
</ul>
<div class="section" id="id2">
<h2>全球平均气温<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>我们使用以前课上用过的 NCEP 再分析资料 air.mon.mean.nc 来计算全球平均气温 (1948-2016)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">display_style</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;xarray.core.options.set_options at 0x7fa204e6c890&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mon_air</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="s1">&#39;air.mon.mean.nc&#39;</span><span class="p">)</span>
<span class="n">mon_air</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>&lt;xarray.DataArray &#x27;air&#x27; (time: 832, lat: 73, lon: 144)&gt;
[8745984 values with dtype=float32]
Coordinates:
  * lat      (lat) float32 90.0 87.5 85.0 82.5 80.0 ... -82.5 -85.0 -87.5 -90.0
  * lon      (lon) float32 0.0 2.5 5.0 7.5 10.0 ... 350.0 352.5 355.0 357.5
  * time     (time) datetime64[ns] 1948-01-01 1948-02-01 ... 2017-04-01
Attributes:
    long_name:     Monthly Mean Air Temperature at sigma level 0.995
    valid_range:   [-2000.  2000.]
    units:         degC
    precision:     1
    var_desc:      Air Temperature
    level_desc:    Surface
    statistic:     Mean
    parent_stat:   Individual Obs
    dataset:       NCEP Reanalysis Derived Products
    actual_range:  [-73.78001  41.74902]</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mon_air_2016</span> <span class="o">=</span> <span class="n">mon_air</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;2016&#39;</span><span class="p">)</span>
<span class="n">mon_air_2016</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>&lt;xarray.DataArray &#x27;air&#x27; (time: 12, lat: 73, lon: 144)&gt;
[126144 values with dtype=float32]
Coordinates:
  * lat      (lat) float32 90.0 87.5 85.0 82.5 80.0 ... -82.5 -85.0 -87.5 -90.0
  * lon      (lon) float32 0.0 2.5 5.0 7.5 10.0 ... 350.0 352.5 355.0 357.5
  * time     (time) datetime64[ns] 2016-01-01 2016-02-01 ... 2016-12-01
Attributes:
    long_name:     Monthly Mean Air Temperature at sigma level 0.995
    valid_range:   [-2000.  2000.]
    units:         degC
    precision:     1
    var_desc:      Air Temperature
    level_desc:    Surface
    statistic:     Mean
    parent_stat:   Individual Obs
    dataset:       NCEP Reanalysis Derived Products
    actual_range:  [-73.78001  41.74902]</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mon_air_2016</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>&lt;xarray.DataArray &#x27;air&#x27; ()&gt;
array(5.7122564, dtype=float32)</pre></div></div>
</div>
<p>这个结果合理吗？</p>
<ul class="simple">
<li><p>每个月长度不同</p></li>
</ul>
<p>参考 http://xarray.pydata.org/en/stable/examples/monthly-means.html</p>
<ul class="simple">
<li><p>更重要的是，地球是个球体，各处的面积并不相同</p></li>
</ul>
<p>在地球经度 $\varphi$ 和纬度 $\lambda$ 处，地球表面微元面积为</p>
<p>$$
dA = R^2\cos\lambda,d\lambda,d\varphi,\qquad  -\pi &lt; \varphi &lt; \pi,, -\frac{\pi}{2} &lt; \lambda &lt; \frac{\pi}{2},
$$</p>
<p>所以在纬度 $[\lambda, \lambda+d\lambda]$ 之间，地球表面面积 $dA\propto\cos\lambda$。</p>
<ul class="simple">
<li><p>我们忽略每月天数的不同，只考虑地球表面积的影响</p></li>
<li><p>建立一个纬度余弦值构成的权重数组，并归一化（权重之和为1）</p></li>
<li><p>先对经度求平均，再用权重对纬度求平均，最后对时间求平均；或者先对经度和时间求平均，再用权重对纬度求平均</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mon_air_2016_zonal</span> <span class="o">=</span> <span class="n">mon_air_2016</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">mon_air_2016</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span>
<span class="n">weight</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>&lt;xarray.DataArray &#x27;lat&#x27; (lat: 73)&gt;
array([-4.3711388e-08,  4.3619454e-02,  8.7155797e-02,  1.3052624e-01,
        1.7364822e-01,  2.1643965e-01,  2.5881907e-01,  3.0070582e-01,
        3.4202015e-01,  3.8268346e-01,  4.2261827e-01,  4.6174860e-01,
        4.9999997e-01,  5.3729957e-01,  5.7357645e-01,  6.0876143e-01,
        6.4278758e-01,  6.7559016e-01,  7.0710677e-01,  7.3727733e-01,
        7.6604444e-01,  7.9335332e-01,  8.1915206e-01,  8.4339142e-01,
        8.6602539e-01,  8.8701081e-01,  9.0630776e-01,  9.2387950e-01,
        9.3969262e-01,  9.5371693e-01,  9.6592581e-01,  9.7629601e-01,
        9.8480773e-01,  9.9144489e-01,  9.9619472e-01,  9.9904823e-01,
        1.0000000e+00,  9.9904823e-01,  9.9619472e-01,  9.9144489e-01,
        9.8480773e-01,  9.7629601e-01,  9.6592581e-01,  9.5371693e-01,
        9.3969262e-01,  9.2387950e-01,  9.0630776e-01,  8.8701081e-01,
        8.6602539e-01,  8.4339142e-01,  8.1915206e-01,  7.9335332e-01,
        7.6604444e-01,  7.3727733e-01,  7.0710677e-01,  6.7559016e-01,
        6.4278758e-01,  6.0876143e-01,  5.7357645e-01,  5.3729957e-01,
        4.9999997e-01,  4.6174860e-01,  4.2261827e-01,  3.8268346e-01,
        3.4202015e-01,  3.0070582e-01,  2.5881907e-01,  2.1643965e-01,
        1.7364822e-01,  1.3052624e-01,  8.7155797e-02,  4.3619454e-02,
       -4.3711388e-08], dtype=float32)
Coordinates:
  * lat      (lat) float32 90.0 87.5 85.0 82.5 80.0 ... -82.5 -85.0 -87.5 -90.0
Attributes:
    units:          degrees_north
    actual_range:   [ 90. -90.]
    long_name:      Latitude
    standard_name:  latitude
    axis:           Y</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mon_air_2016_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">mon_air_2016_zonal</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weight</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>注意：此处用到了 <code class="docutils literal notranslate"><span class="pre">xarray</span></code> 的广播功能</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mon_air_2016_mean</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array(14.723972, dtype=float32)
</pre></div>
</div>
</div>
</div>
<p>这个结果就合理了。</p>
<p>接下来，我们计算 1948-2016 年的年平均气温</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mon_air</span> <span class="o">=</span> <span class="n">mon_air</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1948&#39;</span><span class="p">,</span><span class="s1">&#39;2016&#39;</span><span class="p">))</span>
<span class="n">annual_mean_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">mon_air</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;AS&#39;</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">weight</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annual_mean_temp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>&lt;xarray.DataArray &#x27;air&#x27; (time: 69)&gt;
array([13.627374 , 13.63256  , 13.542421 , 13.688788 , 13.786775 ,
       13.852996 , 13.569222 , 13.556584 , 13.479174 , 13.794247 ,
       13.811653 , 13.766874 , 13.652037 , 13.691757 , 13.637964 ,
       13.642024 , 13.4713545, 13.554589 , 13.627971 , 13.68065  ,
       13.647916 , 13.786194 , 13.764481 , 13.587351 , 13.728676 ,
       13.853309 , 13.572137 , 13.602747 , 13.5329075, 13.880501 ,
       13.803485 , 13.897291 , 14.044812 , 14.026324 , 13.751034 ,
       13.96955  , 13.822173 , 13.812693 , 13.914178 , 14.030236 ,
       14.045397 , 13.876189 , 14.090269 , 14.04588  , 13.754866 ,
       13.700959 , 13.811932 , 13.991104 , 13.831577 , 14.049007 ,
       14.265602 , 14.006957 , 13.999394 , 14.193729 , 14.293406 ,
       14.2818575, 14.193888 , 14.404059 , 14.341925 , 14.346483 ,
       14.214868 , 14.327676 , 14.3926325, 14.252834 , 14.3145895,
       14.354452 , 14.383326 , 14.522596 , 14.723971 ], dtype=float32)
Coordinates:
  * time     (time) datetime64[ns] 1948-01-01 1949-01-01 ... 2016-01-01</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="o">%</span><span class="k">matplotlib</span> inline 

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">annual_mean_temp</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">13</span><span class="p">,</span><span class="mi">15</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Annual mean temperature (&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00B0</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;C)&#39;</span><span class="p">)</span>  <span class="c1"># 度的 unicode </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Annual mean temperature (°C)&#39;)
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_22_1.png" src="../_images/integrated_examples_2_22_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">anomaly</span> <span class="o">=</span> <span class="n">annual_mean_temp</span> <span class="o">-</span> <span class="n">annual_mean_temp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">anomaly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Annual temperature anomaly (&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00B0</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;C)&#39;</span><span class="p">)</span>  <span class="c1"># 度的 unicode </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Annual temperature anomaly (°C)&#39;)
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_23_1.png" src="../_images/integrated_examples_2_23_1.png" />
</div>
</div>
<ul class="simple">
<li><p>我们使用 Theil-Sen 方法来计算气温的趋势。</p></li>
<li><p>Theil-Sen 是一种基于秩（rank）的非参数化（non-parametric）的统计方法，对数据的分布不做任何假设，对 outlier 有很强的稳定性</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">slope</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">beta_lr</span><span class="p">,</span> <span class="n">beta_up</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mstats</span><span class="o">.</span><span class="n">theilslopes</span><span class="p">(</span><span class="n">anomaly</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> 
                                                       <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean value = &#39;</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trend = &#39;</span><span class="p">,</span> <span class="n">slope</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;95</span><span class="si">% c</span><span class="s1">onfidence interval:&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">beta_lr</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">beta_up</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean value =  -0.0830078125
Trend =  0.012706676166727795
95% confidence interval: [ 0.010791723544781025 , 0.014703750610351562 ]
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>可见，1948 - 2016 年间，全球平均气温增加幅度为 0.013 $^o$C/年，或者 0.13 $^o$C/10年。</p></li>
<li><p>我们可以将趋势直线和对应 95% 置信区间的两条趋势直线加到上图中。</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">anomaly</span> <span class="o">=</span> <span class="n">annual_mean_temp</span> <span class="o">-</span> <span class="n">annual_mean_temp</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">anomaly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Annual temperature anomaly (&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00B0</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;C)&#39;</span><span class="p">)</span>  <span class="c1"># 度的 unicode </span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anomaly</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">slope</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anomaly</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">beta_lr</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">anomaly</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">beta_up</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fa1f2814e10&gt;]
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_27_1.png" src="../_images/integrated_examples_2_27_1.png" />
</div>
</div>
<div class="section" id="id3">
<h3>中国区域的平均气温<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>如果我们需要用上面的数据集，求中国的平均气温，该怎么办？</p></li>
</ul>
<ul class="simple">
<li><p>我们需要单独提取出中国区域的气温，将其它区域屏蔽掉</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">regionmask</span></code> 包提供这样的功能</p></li>
<li><p>我们利用 <code class="docutils literal notranslate"><span class="pre">simplified_china_country.shp</span></code> 文件来提取中国区域的气温。由于该 shapefile 不包括海洋，所以我们只计算中国陆地上的平均气温</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">regionmask</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="n">china_shp</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;../shp_file/simplied_china_country.shp&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
<span class="n">china_mask_poly</span> <span class="o">=</span> <span class="n">regionmask</span><span class="o">.</span><span class="n">Regions</span><span class="p">(</span><span class="n">china_shp</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="s1">&#39;china&#39;</span><span class="p">)</span>

<span class="n">china_mask</span> <span class="o">=</span> <span class="n">china_mask_poly</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">mon_air</span><span class="p">)</span>
<span class="c1">#china_mask= np.ma.masked_invalid(china_mask)</span>
<span class="n">china_mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">china_mask</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">china_mask</span><span class="p">)</span>
<span class="n">china_mask</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="n">a3bb9010a30c</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">regionmask</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">china_shp</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;../shp_file/simplied_china_country.shp&#39;</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">china_mask_poly</span> <span class="o">=</span> <span class="n">regionmask</span><span class="o">.</span><span class="n">Regions</span><span class="p">(</span><span class="n">china_shp</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="s1">&#39;china&#39;</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;regionmask&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">china_temp</span> <span class="o">=</span> <span class="n">mon_air</span><span class="o">*</span><span class="n">china_mask</span>
<span class="n">china_temp</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>&lt;xarray.DataArray (time: 828, lat: 73, lon: 144)&gt;
array([[[nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        ...,
...
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]],

       [[nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        ...,
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan],
        [nan, nan, nan, ..., nan, nan, nan]]])
Coordinates:
  * lat      (lat) float32 90.0 87.5 85.0 82.5 80.0 ... -82.5 -85.0 -87.5 -90.0
  * lon      (lon) float32 0.0 2.5 5.0 7.5 10.0 ... 350.0 352.5 355.0 357.5
  * time     (time) datetime64[ns] 1948-01-01 1948-02-01 ... 2016-12-01</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">annual_china_mean_temp</span> <span class="o">=</span> <span class="n">china_temp</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;AS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">china_weight</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">annual_china_mean_temp</span><span class="o">.</span><span class="n">lat</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> 
                                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">annual_china_mean_temp</span><span class="o">.</span><span class="n">lon</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                                    <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span>
                                    <span class="n">coords</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lon&#39;</span><span class="p">:</span><span class="n">annual_china_mean_temp</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span><span class="n">annual_china_mean_temp</span><span class="o">.</span><span class="n">lat</span><span class="p">})</span>
<span class="n">china_weight</span> <span class="o">=</span> <span class="n">china_weight</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">annual_china_mean_temp</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)))</span>
<span class="n">china_weight</span> <span class="o">=</span> <span class="n">china_weight</span><span class="o">/</span><span class="n">china_weight</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">china_weight</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.QuadMesh at 0x7fc0ac281dd0&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_33_1.png" src="../_images/integrated_examples_2_33_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weighted_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">annual_china_mean_temp</span><span class="o">*</span><span class="n">china_weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
<span class="n">weighted_mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre>&lt;xarray.DataArray (time: 69)&gt;
array([6.00252245, 5.5262691 , 5.5719012 , 5.70178283, 5.63743712,
       5.78923133, 5.52567758, 5.55231086, 5.02751334, 5.05981022,
       5.80275971, 5.76755194, 5.5579304 , 5.58284571, 5.25716052,
       5.66430706, 5.37841569, 5.5736212 , 5.70741857, 5.12341224,
       5.35255999, 5.21369367, 5.38544521, 5.14870246, 5.16982935,
       5.61039527, 4.87386947, 5.38338392, 4.97444959, 5.54149615,
       5.45099197, 5.60702818, 5.46653624, 5.39721418, 5.59683034,
       5.34149105, 4.9014431 , 5.17419616, 5.26396819, 5.77013423,
       5.62259181, 5.53908119, 5.93941256, 5.56128708, 5.3924108 ,
       5.34070857, 5.81930224, 5.56635797, 5.34298067, 5.90813401,
       6.53288502, 6.2486403 , 5.64889475, 6.08367246, 6.1787809 ,
       5.89860635, 6.13613846, 5.80128953, 6.48765794, 6.54522217,
       6.01826287, 6.13936008, 6.03853043, 5.63487924, 5.45795952,
       6.35044402, 6.30444362, 6.62997998, 6.75963839])
Coordinates:
  * time     (time) datetime64[ns] 1948-01-01 1949-01-01 ... 2016-01-01</pre></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">china_anomaly</span> <span class="o">=</span> <span class="n">weighted_mean</span> <span class="o">-</span> <span class="n">weighted_mean</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">china_anomaly</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">slope</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">beta_lr</span><span class="p">,</span> <span class="n">beta_up</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">mstats</span><span class="o">.</span><span class="n">theilslopes</span><span class="p">(</span><span class="n">china_anomaly</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> 
                                                       <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean value = &#39;</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trend = &#39;</span><span class="p">,</span> <span class="n">slope</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;95</span><span class="si">% c</span><span class="s1">onfidence interval:&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="n">beta_lr</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">beta_up</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean value =  -0.07456140253892407
Trend =  0.010559139967498625
95% confidence interval: [ 0.00609306997127276 , 0.016278539880497767 ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">china_anomaly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">anomaly</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.5</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;China annual temperature anomaly (&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00B0</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;C)&#39;</span><span class="p">)</span>  <span class="c1"># 度的 unicode </span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">china_anomaly</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">slope</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">china_anomaly</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">beta_lr</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">china_anomaly</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">beta_up</span><span class="o">*</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fc0a9e58290&gt;]
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_36_1.png" src="../_images/integrated_examples_2_36_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="wrf">
<h2>WRF 数据处理和可视化<a class="headerlink" href="#wrf" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>WRF（Weather Research and Forecasting）是广泛应用的区域气象模式</p></li>
<li><p>WRF 是大家数值天气预报课程使用的模式</p></li>
<li><p>WRF 模式的输出是 netCDF 文件，但不是符合 CF（Climate and Forecasting）标准的文件</p></li>
<li><p>NCAR 提供了 <code class="docutils literal notranslate"><span class="pre">wrf-python</span></code> 模块来实现 NCL 中关于 WRF 的部分功能，也提供了 <code class="docutils literal notranslate"><span class="pre">xarray</span></code> 的接口</p></li>
</ul>
<ul class="simple">
<li><p>WRF 使用交错网格，即 Arakawa C 网格</p></li>
</ul>
<p><img alt="" src="../_images/WRF_staggered_grid.gif" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ncdump -h wrfout_d01_2015-09-24_13_extracted.nc
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>netcdf wrfout_d01_2015-09-24_13_extracted {
dimensions:
	Time = UNLIMITED ; // (1 currently)
	bottom_top = 50 ;
	south_north = 449 ;
	west_east = 649 ;
	bottom_top_stag = 51 ;
	DateStrLen = 19 ;
	west_east_stag = 650 ;
	south_north_stag = 450 ;
variables:
	float EXTCOF55(Time, bottom_top, south_north, west_east) ;
		EXTCOF55:FieldType = 104 ;
		EXTCOF55:MemoryOrder = &quot;XYZ&quot; ;
		EXTCOF55:description = &quot;Extinction coefficients for .55um&quot; ;
		EXTCOF55:units = &quot;km^-1&quot; ;
		EXTCOF55:stagger = &quot;&quot; ;
		EXTCOF55:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float HGT(Time, south_north, west_east) ;
		HGT:FieldType = 104 ;
		HGT:MemoryOrder = &quot;XY &quot; ;
		HGT:description = &quot;Terrain Height&quot; ;
		HGT:units = &quot;m&quot; ;
		HGT:stagger = &quot;&quot; ;
		HGT:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float P(Time, bottom_top, south_north, west_east) ;
		P:FieldType = 104 ;
		P:MemoryOrder = &quot;XYZ&quot; ;
		P:description = &quot;perturbation pressure&quot; ;
		P:units = &quot;Pa&quot; ;
		P:stagger = &quot;&quot; ;
		P:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float PB(Time, bottom_top, south_north, west_east) ;
		PB:FieldType = 104 ;
		PB:MemoryOrder = &quot;XYZ&quot; ;
		PB:description = &quot;BASE STATE PRESSURE&quot; ;
		PB:units = &quot;Pa&quot; ;
		PB:stagger = &quot;&quot; ;
		PB:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float PH(Time, bottom_top_stag, south_north, west_east) ;
		PH:FieldType = 104 ;
		PH:MemoryOrder = &quot;XYZ&quot; ;
		PH:description = &quot;perturbation geopotential&quot; ;
		PH:units = &quot;m2 s-2&quot; ;
		PH:stagger = &quot;Z&quot; ;
		PH:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float PHB(Time, bottom_top_stag, south_north, west_east) ;
		PHB:FieldType = 104 ;
		PHB:MemoryOrder = &quot;XYZ&quot; ;
		PHB:description = &quot;base-state geopotential&quot; ;
		PHB:units = &quot;m2 s-2&quot; ;
		PHB:stagger = &quot;Z&quot; ;
		PHB:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float PM2_5_DRY(Time, bottom_top, south_north, west_east) ;
		PM2_5_DRY:FieldType = 104 ;
		PM2_5_DRY:MemoryOrder = &quot;XYZ&quot; ;
		PM2_5_DRY:description = &quot;pm2.5 aerosol dry mass&quot; ;
		PM2_5_DRY:units = &quot;ug m^-3&quot; ;
		PM2_5_DRY:stagger = &quot;&quot; ;
		PM2_5_DRY:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float T(Time, bottom_top, south_north, west_east) ;
		T:FieldType = 104 ;
		T:MemoryOrder = &quot;XYZ&quot; ;
		T:description = &quot;perturbation potential temperature (theta-t0)&quot; ;
		T:units = &quot;K&quot; ;
		T:stagger = &quot;&quot; ;
		T:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	char Times(Time, DateStrLen) ;
	float U(Time, bottom_top, south_north, west_east_stag) ;
		U:FieldType = 104 ;
		U:MemoryOrder = &quot;XYZ&quot; ;
		U:description = &quot;x-wind component&quot; ;
		U:units = &quot;m s-1&quot; ;
		U:stagger = &quot;X&quot; ;
		U:coordinates = &quot;XLONG_U XLAT_U XTIME&quot; ;
	float V(Time, bottom_top, south_north_stag, west_east) ;
		V:FieldType = 104 ;
		V:MemoryOrder = &quot;XYZ&quot; ;
		V:description = &quot;y-wind component&quot; ;
		V:units = &quot;m s-1&quot; ;
		V:stagger = &quot;Y&quot; ;
		V:coordinates = &quot;XLONG_V XLAT_V XTIME&quot; ;
	float W(Time, bottom_top_stag, south_north, west_east) ;
		W:FieldType = 104 ;
		W:MemoryOrder = &quot;XYZ&quot; ;
		W:description = &quot;z-wind component&quot; ;
		W:units = &quot;m s-1&quot; ;
		W:stagger = &quot;Z&quot; ;
		W:coordinates = &quot;XLONG XLAT XTIME&quot; ;
	float XLAT(Time, south_north, west_east) ;
		XLAT:FieldType = 104 ;
		XLAT:MemoryOrder = &quot;XY &quot; ;
		XLAT:description = &quot;LATITUDE, SOUTH IS NEGATIVE&quot; ;
		XLAT:units = &quot;degree_north&quot; ;
		XLAT:stagger = &quot;&quot; ;
		XLAT:coordinates = &quot;XLONG XLAT&quot; ;
	float XLAT_U(Time, south_north, west_east_stag) ;
		XLAT_U:FieldType = 104 ;
		XLAT_U:MemoryOrder = &quot;XY &quot; ;
		XLAT_U:description = &quot;LATITUDE, SOUTH IS NEGATIVE&quot; ;
		XLAT_U:units = &quot;degree_north&quot; ;
		XLAT_U:stagger = &quot;X&quot; ;
		XLAT_U:coordinates = &quot;XLONG_U XLAT_U&quot; ;
	float XLAT_V(Time, south_north_stag, west_east) ;
		XLAT_V:FieldType = 104 ;
		XLAT_V:MemoryOrder = &quot;XY &quot; ;
		XLAT_V:description = &quot;LATITUDE, SOUTH IS NEGATIVE&quot; ;
		XLAT_V:units = &quot;degree_north&quot; ;
		XLAT_V:stagger = &quot;Y&quot; ;
		XLAT_V:coordinates = &quot;XLONG_V XLAT_V&quot; ;
	float XLONG(Time, south_north, west_east) ;
		XLONG:FieldType = 104 ;
		XLONG:MemoryOrder = &quot;XY &quot; ;
		XLONG:description = &quot;LONGITUDE, WEST IS NEGATIVE&quot; ;
		XLONG:units = &quot;degree_east&quot; ;
		XLONG:stagger = &quot;&quot; ;
		XLONG:coordinates = &quot;XLONG XLAT&quot; ;
	float XLONG_U(Time, south_north, west_east_stag) ;
		XLONG_U:FieldType = 104 ;
		XLONG_U:MemoryOrder = &quot;XY &quot; ;
		XLONG_U:description = &quot;LONGITUDE, WEST IS NEGATIVE&quot; ;
		XLONG_U:units = &quot;degree_east&quot; ;
		XLONG_U:stagger = &quot;X&quot; ;
		XLONG_U:coordinates = &quot;XLONG_U XLAT_U&quot; ;
	float XLONG_V(Time, south_north_stag, west_east) ;
		XLONG_V:FieldType = 104 ;
		XLONG_V:MemoryOrder = &quot;XY &quot; ;
		XLONG_V:description = &quot;LONGITUDE, WEST IS NEGATIVE&quot; ;
		XLONG_V:units = &quot;degree_east&quot; ;
		XLONG_V:stagger = &quot;Y&quot; ;
		XLONG_V:coordinates = &quot;XLONG_V XLAT_V&quot; ;
	float ZNU(Time, bottom_top) ;
		ZNU:FieldType = 104 ;
		ZNU:MemoryOrder = &quot;Z  &quot; ;
		ZNU:description = &quot;eta values on half (mass) levels&quot; ;
		ZNU:units = &quot;&quot; ;
		ZNU:stagger = &quot;&quot; ;
	float ZNW(Time, bottom_top_stag) ;
		ZNW:FieldType = 104 ;
		ZNW:MemoryOrder = &quot;Z  &quot; ;
		ZNW:description = &quot;eta values on full (w) levels&quot; ;
		ZNW:units = &quot;&quot; ;
		ZNW:stagger = &quot;Z&quot; ;

// global attributes:
		:TITLE = &quot; OUTPUT FROM *             PROGRAM:WRF-Chem V3.9.1.1 MODEL&quot; ;
		:START_DATE = &quot;2015-09-22_00:00:00&quot; ;
		:SIMULATION_START_DATE = &quot;2015-09-01_00:00:00&quot; ;
		:WEST-EAST_GRID_DIMENSION = 650 ;
		:SOUTH-NORTH_GRID_DIMENSION = 450 ;
		:BOTTOM-TOP_GRID_DIMENSION = 51 ;
		:DX = 5000.f ;
		:DY = 5000.f ;
		:SKEBS_ON = 0 ;
		:SPEC_BDY_FINAL_MU = 1 ;
		:USE_Q_DIABATIC = 0 ;
		:GRIDTYPE = &quot;C&quot; ;
		:DIFF_OPT = 1 ;
		:KM_OPT = 4 ;
		:DAMP_OPT = 0 ;
		:DAMPCOEF = 0.2f ;
		:KHDIF = 0.f ;
		:KVDIF = 0.f ;
		:MP_PHYSICS = 10 ;
		:RA_LW_PHYSICS = 4 ;
		:RA_SW_PHYSICS = 4 ;
		:SF_SFCLAY_PHYSICS = 1 ;
		:SF_SURFACE_PHYSICS = 2 ;
		:BL_PBL_PHYSICS = 1 ;
		:CU_PHYSICS = 0 ;
		:SF_LAKE_PHYSICS = 0 ;
		:SURFACE_INPUT_SOURCE = 1 ;
		:SST_UPDATE = 0 ;
		:GRID_FDDA = 0 ;
		:GFDDA_INTERVAL_M = 0 ;
		:GFDDA_END_H = 0 ;
		:GRID_SFDDA = 0 ;
		:SGFDDA_INTERVAL_M = 0 ;
		:SGFDDA_END_H = 0 ;
		:HYPSOMETRIC_OPT = 2 ;
		:USE_THETA_M = 0 ;
		:GWD_OPT = 0 ;
		:SF_URBAN_PHYSICS = 0 ;
		:SF_OCEAN_PHYSICS = 0 ;
		:SHCU_PHYSICS = 0 ;
		:MFSHCONV = 0 ;
		:FEEDBACK = 0 ;
		:SMOOTH_OPTION = 0 ;
		:SWRAD_SCAT = 1.f ;
		:W_DAMPING = 1 ;
		:DT = 30.f ;
		:RADT = 30.f ;
		:BLDT = 1.f ;
		:CUDT = 1.f ;
		:AER_OPT = 0 ;
		:SWINT_OPT = 0 ;
		:AER_TYPE = 1 ;
		:AER_AOD550_OPT = 1 ;
		:AER_ANGEXP_OPT = 1 ;
		:AER_SSA_OPT = 1 ;
		:AER_ASY_OPT = 1 ;
		:AER_AOD550_VAL = 0.12f ;
		:AER_ANGEXP_VAL = 1.3f ;
		:AER_SSA_VAL = 0.85f ;
		:AER_ASY_VAL = 0.9f ;
		:MOIST_ADV_OPT = 2 ;
		:SCALAR_ADV_OPT = 2 ;
		:TKE_ADV_OPT = 2 ;
		:DIFF_6TH_OPT = 0 ;
		:DIFF_6TH_FACTOR = 0.12f ;
		:OBS_NUDGE_OPT = 0 ;
		:BUCKET_MM = -1.f ;
		:BUCKET_J = -1.f ;
		:PREC_ACC_DT = 0.f ;
		:ISFTCFLX = 0 ;
		:ISHALLOW = 0 ;
		:ISFFLX = 1 ;
		:ICLOUD = 1 ;
		:ICLOUD_CU = 0 ;
		:TRACER_PBLMIX = 1 ;
		:SCALAR_PBLMIX = 0 ;
		:YSU_TOPDOWN_PBLMIX = 0 ;
		:GRAV_SETTLING = 0 ;
		:DFI_OPT = 0 ;
		:SIMULATION_INITIALIZATION_TYPE = &quot;REAL-DATA CASE&quot; ;
		:WEST-EAST_PATCH_START_UNSTAG = 1 ;
		:WEST-EAST_PATCH_END_UNSTAG = 649 ;
		:WEST-EAST_PATCH_START_STAG = 1 ;
		:WEST-EAST_PATCH_END_STAG = 650 ;
		:SOUTH-NORTH_PATCH_START_UNSTAG = 1 ;
		:SOUTH-NORTH_PATCH_END_UNSTAG = 449 ;
		:SOUTH-NORTH_PATCH_START_STAG = 1 ;
		:SOUTH-NORTH_PATCH_END_STAG = 450 ;
		:BOTTOM-TOP_PATCH_START_UNSTAG = 1 ;
		:BOTTOM-TOP_PATCH_END_UNSTAG = 50 ;
		:BOTTOM-TOP_PATCH_START_STAG = 1 ;
		:BOTTOM-TOP_PATCH_END_STAG = 51 ;
		:GRID_ID = 1 ;
		:PARENT_ID = 0 ;
		:I_PARENT_START = 1 ;
		:J_PARENT_START = 1 ;
		:PARENT_GRID_RATIO = 1 ;
		:CEN_LAT = 0.f ;
		:CEN_LON = 107.f ;
		:TRUELAT1 = 0.f ;
		:TRUELAT2 = 1.e+20f ;
		:MOAD_CEN_LAT = 0.f ;
		:STAND_LON = 107.f ;
		:POLE_LAT = 90.f ;
		:POLE_LON = 0.f ;
		:GMT = 0.f ;
		:JULYR = 2015 ;
		:JULDAY = 244 ;
		:MAP_PROJ = 3 ;
		:MAP_PROJ_CHAR = &quot;Mercator&quot; ;
		:MMINLU = &quot;MODIFIED_IGBP_MODIS_NOAH&quot; ;
		:NUM_LAND_CAT = 20 ;
		:ISWATER = 17 ;
		:ISLAKE = -1 ;
		:ISICE = 15 ;
		:ISURBAN = 13 ;
		:ISOILWATER = 14 ;
		:HYBRID_OPT = -1 ;
		:ETAC = 0.f ;
		:history = &quot;Thu Apr 16 22:21:49 2020: ncks -v Times,XLAT,XLONG,XLAT_U,XLONG_U,XLAT_V,XLONG_V,U,V,W,W,PH,PHB,T,P,PB,PM2_5_DRY,EXTCOF55,ZNW,ZNU,HGT wrfout_d01_2015-09-24_13:00:00 wrfout_d01_2015-09-24_13_extracted.nc&quot; ;
		:NCO = &quot;\&quot;4.5.5\&quot;&quot; ;
}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">wrf</span>
<span class="kn">import</span> <span class="nn">xarray</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
</pre></div>
</div>
</div>
</div>
<p>首先读入文件</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ifile</span> <span class="o">=</span> <span class="s1">&#39;wrfout_d01_2015-09-24_13_extracted.nc&#39;</span>
<span class="n">title_str</span> <span class="o">=</span> <span class="s1">&#39;21:00 24 Sep 2015&#39;</span>
<span class="n">file_str</span> <span class="o">=</span> <span class="s1">&#39;20150924_2100&#39;</span>

<span class="n">fin</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>其次，读取所需的变量</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PM25</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span><span class="s1">&#39;PM2_5_DRY&#39;</span><span class="p">)</span>
<span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">latlon_coords</span><span class="p">(</span><span class="n">PM25</span><span class="p">)</span>
<span class="n">cart_proj</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">get_cartopy</span><span class="p">(</span><span class="n">PM25</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">)</span> 
<span class="n">ua</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s2">&quot;ua&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m s-1&quot;</span><span class="p">)</span> 
<span class="n">va</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s2">&quot;va&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m s-1&quot;</span><span class="p">)</span> 
<span class="n">wspd</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s2">&quot;wspd_wdir&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m s-1&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:]</span>
</pre></div>
</div>
</div>
</div>
<p>再将相关变量插值到 925 hPa 高度（海拔约 1 km）</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate u, and v winds to 925 hPa</span>
<span class="n">u_925</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">interplevel</span><span class="p">(</span><span class="n">ua</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">925</span><span class="p">)</span>
<span class="n">v_925</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">interplevel</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">925</span><span class="p">)</span>
<span class="n">wspd_925</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">interplevel</span><span class="p">(</span><span class="n">wspd</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">925</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">cartopy.mpl.ticker</span> <span class="kn">import</span> <span class="n">LongitudeFormatter</span><span class="p">,</span> <span class="n">LatitudeFormatter</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">cart_proj</span><span class="p">})</span>

<span class="n">PM25</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">bottom_top</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;XLONG&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;XLAT&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">levels</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span><span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="mi">95</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">120</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span><span class="n">zero_direction_label</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>

<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
          <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PM2.5 ($\mu$g m$^{-3}$) at &#39;</span><span class="o">+</span><span class="n">title_str</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>

<span class="n">Q</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">lons</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">20</span><span class="p">]),</span> <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">lats</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">20</span><span class="p">]),</span>
        <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">u_925</span><span class="p">[::</span><span class="mi">20</span><span class="p">,</span> <span class="p">::</span><span class="mi">20</span><span class="p">]),</span> <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">v_925</span><span class="p">[::</span><span class="mi">20</span><span class="p">,</span> <span class="p">::</span><span class="mi">20</span><span class="p">]),</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">)</span>
<span class="n">qk</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;8 ms$^{-1}$&#39;</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> 
        <span class="n">labelsep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">)</span>

<span class="c1">#plot the line for cross plotting</span>
<span class="n">start_point</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">CoordPair</span><span class="p">(</span><span class="n">lat</span><span class="o">=-</span><span class="mf">5.55</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mf">104.77</span><span class="p">)</span>
<span class="n">end_point</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">CoordPair</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="mf">5.32</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mf">103.2661</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">start_point</span><span class="o">.</span><span class="n">lon</span><span class="p">,</span> <span class="n">end_point</span><span class="o">.</span><span class="n">lon</span><span class="p">],</span>
        <span class="p">[</span><span class="n">start_point</span><span class="o">.</span><span class="n">lat</span><span class="p">,</span> <span class="n">end_point</span><span class="o">.</span><span class="n">lat</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/miniconda3/lib/python3.7/site-packages/cartopy/mpl/geoaxes.py:1841: RuntimeWarning: invalid value encountered in cos
  u, v = self.projection.transform_vectors(t, x, y, u, v)
/opt/miniconda3/lib/python3.7/site-packages/cartopy/mpl/geoaxes.py:1841: RuntimeWarning: invalid value encountered in sin
  u, v = self.projection.transform_vectors(t, x, y, u, v)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7fc07537e910&gt;]
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_49_2.png" src="../_images/integrated_examples_2_49_2.png" />
</div>
</div>
<p>由于研究重点是对新加坡空气质量的影响，我们将上图缩进到新加坡周边</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># zoomed view around Singapore</span>
<span class="n">PM25_zoom</span> <span class="o">=</span> <span class="n">PM25</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">bottom_top</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">south_north</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">320</span><span class="p">),</span><span class="n">west_east</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span><span class="mi">330</span><span class="p">))</span>
<span class="n">u_925_zoom</span> <span class="o">=</span> <span class="n">u_925</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">south_north</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">320</span><span class="p">),</span><span class="n">west_east</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span><span class="mi">330</span><span class="p">))</span> 
<span class="n">v_925_zoom</span> <span class="o">=</span> <span class="n">v_925</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">south_north</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">320</span><span class="p">),</span><span class="n">west_east</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">190</span><span class="p">,</span><span class="mi">330</span><span class="p">))</span>
<span class="n">lats_zoom</span><span class="p">,</span> <span class="n">lons_zoom</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">latlon_coords</span><span class="p">(</span><span class="n">PM25_zoom</span><span class="p">)</span> 
<span class="n">cart_proj</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">get_cartopy</span><span class="p">(</span><span class="n">PM25_zoom</span><span class="p">)</span>

<span class="n">fig2</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">cart_proj</span><span class="p">})</span>

<span class="n">PM25_zoom</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;XLONG&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;XLAT&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
         <span class="n">levels</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
         <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span><span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="mi">101</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mf">4.2</span><span class="p">],</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">102</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">106</span><span class="p">],</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span><span class="n">zero_direction_label</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
         <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">108</span><span class="p">])</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PM2.5 ($\mu$g m$^{-3}$) at &#39;</span><span class="o">+</span><span class="n">title_str</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>

<span class="n">Q2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">lons_zoom</span><span class="p">[::</span><span class="mi">10</span><span class="p">,::</span><span class="mi">10</span><span class="p">]),</span> <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">lats_zoom</span><span class="p">[::</span><span class="mi">10</span><span class="p">,::</span><span class="mi">10</span><span class="p">]),</span>
         <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">u_925_zoom</span><span class="p">[::</span><span class="mi">10</span><span class="p">,</span> <span class="p">::</span><span class="mi">10</span><span class="p">]),</span> <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">v_925_zoom</span><span class="p">[::</span><span class="mi">10</span><span class="p">,</span> <span class="p">::</span><span class="mi">10</span><span class="p">]),</span>
         <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">)</span>
<span class="n">qk2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">Q2</span><span class="p">,</span> <span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;8 ms$^{-1}$&#39;</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span>
         <span class="n">labelsep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/integrated_examples_2_51_0.png" src="../_images/integrated_examples_2_51_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">z</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">wa</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span> <span class="s2">&quot;wa&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m s-1&quot;</span><span class="p">)</span>

<span class="n">start_point</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">CoordPair</span><span class="p">(</span><span class="n">lat</span><span class="o">=-</span><span class="mf">5.55</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mf">104.77</span><span class="p">)</span>
<span class="n">end_point</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">CoordPair</span><span class="p">(</span><span class="n">lat</span><span class="o">=</span><span class="mf">5.32</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="mf">103.2661</span><span class="p">)</span>

<span class="n">PM25_cross</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">vertcross</span><span class="p">(</span><span class="n">PM25</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wrfin</span><span class="o">=</span><span class="n">fin</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">,</span>
                 <span class="n">end_point</span><span class="o">=</span><span class="n">end_point</span><span class="p">,</span> <span class="n">autolevels</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">latlon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">va_cross</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">vertcross</span><span class="p">(</span><span class="n">va</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wrfin</span><span class="o">=</span><span class="n">fin</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">,</span> 
                 <span class="n">end_point</span><span class="o">=</span><span class="n">end_point</span><span class="p">,</span> <span class="n">autolevels</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">latlon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
<span class="n">wa_cross</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">vertcross</span><span class="p">(</span><span class="n">wa</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">wrfin</span><span class="o">=</span><span class="n">fin</span><span class="p">,</span> <span class="n">start_point</span><span class="o">=</span><span class="n">start_point</span><span class="p">,</span>
                 <span class="n">end_point</span><span class="o">=</span><span class="n">end_point</span><span class="p">,</span> <span class="n">autolevels</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">latlon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fig3</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">vert_vals</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">PM25_cross</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;vertical&quot;</span><span class="p">])</span>
<span class="n">vert_level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">vert_vals</span><span class="o">&gt;</span><span class="mf">4000.0</span><span class="p">)</span>

<span class="n">contour_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="n">PM25_contour</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">PM25_cross</span><span class="p">)[:</span><span class="n">vert_level</span><span class="o">+</span><span class="mi">1</span><span class="p">,:],</span><span class="n">contour_levels</span><span class="p">,</span> 
                            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>  
<span class="n">PM25_contour</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">cb_PM25</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">PM25_contour</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
<span class="n">cb_PM25</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">coord_pairs</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">PM25_cross</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s2">&quot;xy_loc&quot;</span><span class="p">])</span>
<span class="n">x_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">coord_pairs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
<span class="n">x_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">pair</span><span class="o">.</span><span class="n">latlon_str</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">, </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">coord_pairs</span><span class="p">)]</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">[::</span><span class="mi">20</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">x_labels</span><span class="p">[::</span><span class="mi">20</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">vert_vals</span> <span class="o">=</span> <span class="n">vert_vals</span><span class="p">[:</span><span class="n">vert_level</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
<span class="n">v_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vert_vals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">y_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">vert_vals</span><span class="p">]</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">v_ticks</span><span class="p">[::</span><span class="mi">10</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">y_labels</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Latitude, Longitude&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Height (m)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">Q3</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">x_ticks</span><span class="p">[::</span><span class="mi">5</span><span class="p">]),</span><span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">v_ticks</span><span class="p">[::</span><span class="mi">5</span><span class="p">]),</span>
        <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">va_cross</span><span class="p">[:</span><span class="n">vert_level</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,::</span><span class="mi">5</span><span class="p">]),</span>
        <span class="n">wrf</span><span class="o">.</span><span class="n">to_np</span><span class="p">(</span><span class="n">wa_cross</span><span class="p">[:</span><span class="n">vert_level</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="mi">5</span><span class="p">,::</span><span class="mi">5</span><span class="p">]))</span>
<span class="n">qk3</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">Q3</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;6 ms$^{-1}$&#39;</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span>
        <span class="n">labelsep</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">coordinates</span><span class="o">=</span><span class="s1">&#39;figure&#39;</span><span class="p">)</span>

<span class="n">singapore_start</span> <span class="o">=</span> <span class="mf">1.254</span>
<span class="n">singapore_end</span> <span class="o">=</span> <span class="mf">1.478</span>
<span class="n">line_lats</span><span class="p">,</span> <span class="n">line_lons</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">pairs_to_latlon</span><span class="p">(</span><span class="n">coord_pairs</span><span class="p">)</span>
<span class="n">ax_start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_lats</span><span class="p">)</span><span class="o">&gt;</span><span class="n">singapore_start</span><span class="p">)</span>
<span class="n">ax_end</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_lats</span><span class="p">)</span><span class="o">&lt;</span><span class="n">singapore_end</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_ticks</span><span class="p">[</span><span class="n">ax_start</span><span class="p">],</span><span class="n">x_ticks</span><span class="p">[</span><span class="n">ax_end</span><span class="p">]],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PM2.5 ($\mu$g m$^{-3}$) at &#39;</span><span class="o">+</span><span class="n">title_str</span><span class="p">,</span><span class="n">fontdict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;PM2.5 ($\\mu$g m$^{-3}$) at 21:00 24 Sep 2015&#39;)
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_52_1.png" src="../_images/integrated_examples_2_52_1.png" />
</div>
</div>
<p>此外，我们还可以计算该区域的气溶胶光学厚度（aerosol optical depth, AOD）。它是消光系数在高度上的积分
$$
AOD = \int_0^{top}\tau(z) dz,
$$
其中，$z$ 为 WRF 网格的垂直高度，$\tau(z)$ 为高度 $z$ 处的消光系数。</p>
<p>这里我们使用 550 nm 光波的消光系数，WRF 中的变量名为 EXTCOF55。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zdiff</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;bottom_top&#39;</span><span class="p">)</span>
<span class="n">extcof</span> <span class="o">=</span> <span class="n">wrf</span><span class="o">.</span><span class="n">getvar</span><span class="p">(</span><span class="n">fin</span><span class="p">,</span><span class="s1">&#39;EXTCOF55&#39;</span><span class="p">,</span><span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">aod</span> <span class="o">=</span> <span class="n">extcof</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">bottom_top</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">49</span><span class="p">))</span><span class="o">*</span><span class="n">zdiff</span> 
<span class="n">aod</span> <span class="o">=</span> <span class="n">aod</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;bottom_top&#39;</span><span class="p">)</span><span class="o">/</span><span class="mf">1000.0</span>  <span class="c1"># EXTCOF55 单位为 &quot;km^-1&quot;</span>
<span class="n">fin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig4</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">cart_proj</span><span class="p">})</span>
<span class="n">aod</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;XLONG&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;XLAT&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">levels</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span><span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;AOD&#39;</span><span class="p">})</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="mi">95</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">120</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span><span class="n">zero_direction_label</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">()</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>

<span class="n">gl</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
          <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/integrated_examples_2_55_0.png" src="../_images/integrated_examples_2_55_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span> 

<span class="n">fig5</span><span class="p">,</span> <span class="n">ax5</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span><span class="n">cart_proj</span><span class="p">})</span>
<span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">])</span>
<span class="n">aod</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;XLONG&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;XLAT&#39;</span><span class="p">,</span><span class="c1">#vmin=0,vmax=10,</span>
        <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">,</span><span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;AOD&#39;</span><span class="p">})</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="mi">95</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">120</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">lon_formatter</span> <span class="o">=</span> <span class="n">LongitudeFormatter</span><span class="p">(</span><span class="n">zero_direction_label</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lat_formatter</span> <span class="o">=</span> <span class="n">LatitudeFormatter</span><span class="p">()</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lon_formatter</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">lat_formatter</span><span class="p">)</span>

<span class="n">gl</span> <span class="o">=</span> <span class="n">ax5</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
          <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">])</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/integrated_examples_2_56_0.png" src="../_images/integrated_examples_2_56_0.png" />
</div>
</div>
<div class="section" id="ncl-python-geocat">
<h3>NCL -&gt; Python: geoCAT<a class="headerlink" href="#ncl-python-geocat" title="Permalink to this headline">¶</a></h3>
<p>https://geocat-examples.readthedocs.io/en/latest/gallery</p>
</div>
<div class="section" id="metpy">
<h3>MetPy<a class="headerlink" href="#metpy" title="Permalink to this headline">¶</a></h3>
<p>https://unidata.github.io/MetPy/latest/index.html</p>
</div>
<div class="section" id="unidata-python-gallery">
<h3>Unidata Python Gallery<a class="headerlink" href="#unidata-python-gallery" title="Permalink to this headline">¶</a></h3>
<p>https://unidata.github.io/python-training/gallery/gallery-home/</p>
</div>
</div>
<div class="section" id="id4">
<h2>时间序列分析和可视化<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>Python 提供了很多辅助工具来处理时间序列</p>
<ul class="simple">
<li><p>标准库：date, datetime</p></li>
<li><p>Pandas: pandas.to_datetime, pandas.date_range</p></li>
<li><p>Matplotlib: matplotlib.dates</p></li>
</ul>
<p>我们利用 Global Historical Climate Network Daily (GHCND) 数据，探讨广州和阳江 1951-2019 气候日变化特征。</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ghcnd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;GHCN_GZ_YJ.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ghcnd</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 50191 entries, 0 to 50190
Data columns (total 14 columns):
 #   Column           Non-Null Count  Dtype  
---  ------           --------------  -----  
 0   STATION          50191 non-null  object 
 1   NAME             50191 non-null  object 
 2   LATITUDE         50191 non-null  float64
 3   LONGITUDE        50191 non-null  float64
 4   ELEVATION        50191 non-null  float64
 5   DATE             50191 non-null  object 
 6   PRCP             47952 non-null  float64
 7   PRCP_ATTRIBUTES  47952 non-null  object 
 8   TAVG             50068 non-null  float64
 9   TAVG_ATTRIBUTES  50068 non-null  object 
 10  TMAX             46154 non-null  float64
 11  TMAX_ATTRIBUTES  46154 non-null  object 
 12  TMIN             48338 non-null  float64
 13  TMIN_ATTRIBUTES  48338 non-null  object 
dtypes: float64(7), object(7)
memory usage: 5.4+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ghcnd</span><span class="o">.</span><span class="n">DATE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ghcnd</span><span class="o">.</span><span class="n">DATE</span><span class="p">)</span>
<span class="n">ghcnd</span> <span class="o">=</span> <span class="n">ghcnd</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ELEVATION&#39;</span><span class="p">,</span><span class="s1">&#39;PRCP_ATTRIBUTES&#39;</span><span class="p">,</span><span class="s1">&#39;TAVG_ATTRIBUTES&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;TMAX_ATTRIBUTES&#39;</span><span class="p">,</span><span class="s1">&#39;TMIN_ATTRIBUTES&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gz</span> <span class="o">=</span> <span class="n">ghcnd</span><span class="p">[</span><span class="n">ghcnd</span><span class="o">.</span><span class="n">NAME</span><span class="o">==</span><span class="s1">&#39;GUANGZHOU, CH&#39;</span><span class="p">]</span>
<span class="n">yj</span> <span class="o">=</span> <span class="n">ghcnd</span><span class="p">[</span><span class="n">ghcnd</span><span class="o">.</span><span class="n">NAME</span><span class="o">==</span><span class="s1">&#39;YANGJIANG, CH&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;DATE&#39;</span><span class="p">)</span>
<span class="n">yj</span> <span class="o">=</span> <span class="n">yj</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;DATE&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span> <span class="o">=</span> <span class="n">gz</span><span class="p">[</span><span class="s1">&#39;1949&#39;</span><span class="p">:</span><span class="s1">&#39;2019&#39;</span><span class="p">]</span>
<span class="n">yj</span> <span class="o">=</span> <span class="n">yj</span><span class="p">[</span><span class="s1">&#39;1949&#39;</span><span class="p">:</span><span class="s1">&#39;2019&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>为确保时间序列的时间是连续的，一般需要重新指定 index 值</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1951-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2019-12-31&#39;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
<span class="n">yj</span> <span class="o">=</span> <span class="n">yj</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;1952-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2019-12-31&#39;</span><span class="p">,</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>PRCP</th>
      <th>TAVG</th>
      <th>TMAX</th>
      <th>TMIN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.517500e+04</td>
      <td>2.517500e+04</td>
      <td>24084.000000</td>
      <td>25054.000000</td>
      <td>22876.000000</td>
      <td>24084.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.321700e+01</td>
      <td>1.134830e+02</td>
      <td>5.200872</td>
      <td>22.270316</td>
      <td>26.459901</td>
      <td>18.962647</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.552784e-15</td>
      <td>2.842227e-14</td>
      <td>14.496849</td>
      <td>6.167283</td>
      <td>6.345923</td>
      <td>6.306987</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.321700e+01</td>
      <td>1.134830e+02</td>
      <td>0.000000</td>
      <td>2.900000</td>
      <td>4.300000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.321700e+01</td>
      <td>1.134830e+02</td>
      <td>0.000000</td>
      <td>17.700000</td>
      <td>22.300000</td>
      <td>14.200000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.321700e+01</td>
      <td>1.134830e+02</td>
      <td>0.000000</td>
      <td>23.700000</td>
      <td>27.700000</td>
      <td>20.600000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2.321700e+01</td>
      <td>1.134830e+02</td>
      <td>2.700000</td>
      <td>27.400000</td>
      <td>31.600000</td>
      <td>24.400000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.321700e+01</td>
      <td>1.134830e+02</td>
      <td>284.900000</td>
      <td>34.400000</td>
      <td>39.100000</td>
      <td>30.400000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yj</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LATITUDE</th>
      <th>LONGITUDE</th>
      <th>PRCP</th>
      <th>TAVG</th>
      <th>TMAX</th>
      <th>TMIN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.480800e+04</td>
      <td>2.480800e+04</td>
      <td>23662.000000</td>
      <td>24806.000000</td>
      <td>23092.00000</td>
      <td>24062.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.186700e+01</td>
      <td>1.119670e+02</td>
      <td>6.778747</td>
      <td>22.545283</td>
      <td>26.32681</td>
      <td>19.702593</td>
    </tr>
    <tr>
      <th>std</th>
      <td>7.105571e-15</td>
      <td>2.842228e-14</td>
      <td>22.218934</td>
      <td>5.512921</td>
      <td>5.48785</td>
      <td>5.842219</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.186700e+01</td>
      <td>1.119670e+02</td>
      <td>0.000000</td>
      <td>3.200000</td>
      <td>5.70000</td>
      <td>-1.400000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.186700e+01</td>
      <td>1.119670e+02</td>
      <td>0.000000</td>
      <td>18.600000</td>
      <td>23.00000</td>
      <td>15.400000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.186700e+01</td>
      <td>1.119670e+02</td>
      <td>0.000000</td>
      <td>23.900000</td>
      <td>27.50000</td>
      <td>21.400000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2.186700e+01</td>
      <td>1.119670e+02</td>
      <td>2.700000</td>
      <td>27.200000</td>
      <td>30.70000</td>
      <td>24.600000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.186700e+01</td>
      <td>1.119670e+02</td>
      <td>605.300000</td>
      <td>32.300000</td>
      <td>38.30000</td>
      <td>28.800000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>我们先来求历史上的最高、最低温度记录，以及最高日降雨量记录</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span><span class="o">.</span><span class="n">TMAX</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">gz</span><span class="o">.</span><span class="n">TMAX</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">gz</span><span class="o">.</span><span class="n">TMIN</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">gz</span><span class="o">.</span><span class="n">TMIN</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="n">gz</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">gz</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(39.1,
 Timestamp(&#39;2004-07-01 00:00:00&#39;, freq=&#39;D&#39;),
 0.0,
 Timestamp(&#39;1957-02-11 00:00:00&#39;, freq=&#39;D&#39;),
 284.9,
 Timestamp(&#39;1955-06-06 00:00:00&#39;, freq=&#39;D&#39;))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yj</span><span class="o">.</span><span class="n">TMAX</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">yj</span><span class="o">.</span><span class="n">TMAX</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">yj</span><span class="o">.</span><span class="n">TMIN</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">yj</span><span class="o">.</span><span class="n">TMIN</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="n">yj</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">yj</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(38.3,
 Timestamp(&#39;2005-07-19 00:00:00&#39;, freq=&#39;D&#39;),
 -1.4,
 Timestamp(&#39;1955-01-12 00:00:00&#39;, freq=&#39;D&#39;),
 605.3,
 Timestamp(&#39;2001-06-08 00:00:00&#39;, freq=&#39;D&#39;))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">gz</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;dayofyear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofyear</span>
<span class="n">yj</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">yj</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;dayofyear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofyear</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="s1">&#39;dayofyear&#39;</span><span class="p">,</span><span class="s1">&#39;PRCP&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">gz</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">366.5</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">300</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">61</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">153</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">214</span><span class="p">,</span><span class="mi">245</span><span class="p">,</span><span class="mi">275</span><span class="p">,</span><span class="mi">306</span><span class="p">,</span><span class="mi">336</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Precipitation (mm)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/integrated_examples_2_75_0.png" src="../_images/integrated_examples_2_75_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz_monthly_rain</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">gz_monthly_rain</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">900</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Monthly rainfall (mm)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Monthly rainfall (mm)&#39;)
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_77_1.png" src="../_images/integrated_examples_2_77_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz_monthly_rain</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">gz_monthly_rain</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_78_1.png" src="../_images/integrated_examples_2_78_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yj_monthly_rain</span> <span class="o">=</span> <span class="n">yj</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">yj_monthly_rain</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">yj_monthly_rain</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_79_1.png" src="../_images/integrated_examples_2_79_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Guangzhou&#39;</span><span class="p">)</span>
<span class="n">yj</span><span class="o">.</span><span class="n">PRCP</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Yangjiang&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc066513b10&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_80_1.png" src="../_images/integrated_examples_2_80_1.png" />
</div>
</div>
<div class="section" id="id5">
<h3>极端天气分析<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>我们分析每年下雨的天数、高温（$&gt;35 ^oC$) 的天数以及低温（$&lt;10 ^oC$）的天数</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz_rainyDays</span> <span class="o">=</span> <span class="n">gz</span><span class="p">[</span><span class="n">gz</span><span class="o">.</span><span class="n">PRCP</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">]</span>
<span class="n">gz_rainyDays</span> <span class="o">=</span> <span class="n">gz_rainyDays</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">gz_rainyDays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="s1">&#39;PRCP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">gz_hotDays</span> <span class="o">=</span> <span class="n">gz</span><span class="p">[</span><span class="n">gz</span><span class="o">.</span><span class="n">TMAX</span><span class="o">&gt;=</span><span class="mf">35.0</span><span class="p">]</span>
<span class="n">gz_hotDays</span> <span class="o">=</span> <span class="n">gz_hotDays</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">gz_hotDays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="s1">&#39;TMAX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">gz_coldDays</span> <span class="o">=</span> <span class="n">gz</span><span class="p">[</span><span class="n">gz</span><span class="o">.</span><span class="n">TMIN</span><span class="o">&lt;=</span><span class="mf">10.0</span><span class="p">]</span>
<span class="n">gz_coldDays</span> <span class="o">=</span> <span class="n">gz_coldDays</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">gz_coldDays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="s1">&#39;TMIN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">gz_rainyDays</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rainy days&#39;</span><span class="p">)</span>
<span class="n">gz_hotDays</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hot days&#39;</span><span class="p">)</span>
<span class="n">gz_coldDays</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cold days&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc05cd90610&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_83_1.png" src="../_images/integrated_examples_2_83_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yj_rainyDays</span> <span class="o">=</span> <span class="n">yj</span><span class="p">[</span><span class="n">yj</span><span class="o">.</span><span class="n">PRCP</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">]</span>
<span class="n">yj_rainyDays</span> <span class="o">=</span> <span class="n">yj_rainyDays</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">yj_rainyDays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="s1">&#39;PRCP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">yj_hotDays</span> <span class="o">=</span> <span class="n">yj</span><span class="p">[</span><span class="n">yj</span><span class="o">.</span><span class="n">TMAX</span><span class="o">&gt;=</span><span class="mf">35.0</span><span class="p">]</span>
<span class="n">yj_hotDays</span> <span class="o">=</span> <span class="n">yj_hotDays</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">yj_hotDays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="s1">&#39;TMAX&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">yj_coldDays</span> <span class="o">=</span> <span class="n">yj</span><span class="p">[</span><span class="n">yj</span><span class="o">.</span><span class="n">TMIN</span><span class="o">&lt;=</span><span class="mf">10.0</span><span class="p">]</span>
<span class="n">yj_coldDays</span> <span class="o">=</span> <span class="n">yj_coldDays</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">yj_coldDays</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">)[</span><span class="s1">&#39;TMIN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">yj_rainyDays</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rainy days&#39;</span><span class="p">)</span>
<span class="n">yj_hotDays</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Hot days&#39;</span><span class="p">)</span>
<span class="n">yj_coldDays</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cold days&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc05afcc410&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_85_1.png" src="../_images/integrated_examples_2_85_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#ax = gz.TAVG.plot(kind=&#39;kde&#39;,label=&#39;Average&#39;)</span>
<span class="c1">#gz.TMAX.plot(ax=ax,kind=&#39;kde&#39;,label=&#39;Maximum&#39;)</span>
<span class="c1">#gz.TMIN.plot(ax=ax,kind=&#39;kde&#39;,label=&#39;Minimum&#39;)</span>
<span class="c1">#ax.legend()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">gz</span><span class="p">[[</span><span class="s1">&#39;TAVG&#39;</span><span class="p">,</span><span class="s1">&#39;TMAX&#39;</span><span class="p">,</span><span class="s1">&#39;TMIN&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">kde</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Average&#39;</span><span class="p">,</span><span class="s1">&#39;Maximum&#39;</span><span class="p">,</span><span class="s1">&#39;Minimum&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7fc05b02b050&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_86_1.png" src="../_images/integrated_examples_2_86_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">groups</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">TAVG</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;AS&#39;</span><span class="p">))</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">calendar</span><span class="o">.</span><span class="n">isleap</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
        <span class="n">years</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="mi">59</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">years</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">values</span>

<span class="n">years</span> <span class="o">=</span> <span class="n">years</span><span class="o">.</span><span class="n">T</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">years</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">59</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="mi">151</span><span class="p">,</span><span class="mi">181</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">243</span><span class="p">,</span><span class="mi">273</span><span class="p">,</span><span class="mi">304</span><span class="p">,</span><span class="mi">334</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)],</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Text(0, 0, &#39;1&#39;),
 Text(31, 0, &#39;2&#39;),
 Text(59, 0, &#39;3&#39;),
 Text(90, 0, &#39;4&#39;),
 Text(120, 0, &#39;5&#39;),
 Text(151, 0, &#39;6&#39;),
 Text(181, 0, &#39;7&#39;),
 Text(212, 0, &#39;8&#39;),
 Text(243, 0, &#39;9&#39;),
 Text(273, 0, &#39;10&#39;),
 Text(304, 0, &#39;11&#39;),
 Text(334, 0, &#39;12&#39;)]
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_87_1.png" src="../_images/integrated_examples_2_87_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">gz_annual_max_temp</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">TMAX</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">gz_annual_max_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gz_annual_max_temp</span><span class="p">)</span>
<span class="n">gz_annual_max_temp</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gz_annual_max_temp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>
<span class="n">gz_annual_max_temp</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gz_annual_max_temp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
<span class="n">max_temp</span> <span class="o">=</span> <span class="n">gz_annual_max_temp</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span><span class="s2">&quot;Month&quot;</span><span class="p">,</span><span class="s2">&quot;TMAX&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">max_temp</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Month&#39;, ylabel=&#39;Year&#39;&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_88_1.png" src="../_images/integrated_examples_2_88_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">yj_annual_max_temp</span> <span class="o">=</span> <span class="n">yj</span><span class="o">.</span><span class="n">TMAX</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">yj_annual_max_temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">yj_annual_max_temp</span><span class="p">)</span>
<span class="n">yj_annual_max_temp</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yj_annual_max_temp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>
<span class="n">yj_annual_max_temp</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yj_annual_max_temp</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
<span class="n">max_temp</span> <span class="o">=</span> <span class="n">yj_annual_max_temp</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span><span class="s2">&quot;Month&quot;</span><span class="p">,</span><span class="s2">&quot;TMAX&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">max_temp</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Reds&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;Month&#39;, ylabel=&#39;Year&#39;&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_89_1.png" src="../_images/integrated_examples_2_89_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gz</span><span class="p">[</span><span class="s1">&#39;DTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gz</span><span class="p">[</span><span class="s1">&#39;TMAX&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">gz</span><span class="p">[</span><span class="s1">&#39;TMIN&#39;</span><span class="p">]</span>
<span class="n">gz</span><span class="o">.</span><span class="n">DTR</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">gz</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">yj</span><span class="p">[</span><span class="s1">&#39;DTR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">yj</span><span class="p">[</span><span class="s1">&#39;TMAX&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">yj</span><span class="p">[</span><span class="s1">&#39;TMIN&#39;</span><span class="p">]</span>
<span class="n">yj</span><span class="o">.</span><span class="n">DTR</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">yj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../_images/integrated_examples_2_90_1.png" src="../_images/integrated_examples_2_90_1.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Integrated_examples"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="integrated_examples_1.html" title="previous page">地图数据处理及可视化</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Xianxiang Li<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>